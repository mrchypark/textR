---
title: "텍스트 분석을 위한 R 패키지 설치 가이드"
author: "박찬엽"
date: "2018년 09월 13일"
output:
  xaringan::moon_reader:
    seal: false
    css: ["default", "custom.css"]
    lib_dir: libs
    includes:
      in_header: google_analytics.html
    nature:
      highlightStyle: github
      highlightLines: true
      navigation: {click: true}
      countIncrementalSlides: false
      ratio: '16:9'
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(cache = T, fig.height = 5)
library(nycflights13)
```

class: center, middle, title-slide, inverse

## 텍스트 분석을 위한 R 패키지 설치 가이드

### <https://mrchypark.github.io/textR>

#### [[pdf버전]](https://github.com/mrchypark/textR/blob/master/docs/textR.pdf) [[문의하기]](http://pf.kakao.com/_RXANd) [[의견 및 오류 신고]](https://github.com/mrchypark/textR/issues/new)
#### [스타누르기](https://github.com/mrchypark/textR)는 컨텐츠 제작자를 춤추게 합니다.

### 박찬엽

### 2018년 09월 13일
---
class: center, middle, title-slide, inverse

## windows 10 사용자

---
class: inverse

## 설치를 위한 패키지 설치

아래 코드를 R 콘솔에서 실행하세요.

```{}
install.packages("remotes")
library(remotes)
install.packages("installr", type = "binary")
library(installr)

# 설치 화면이 나오는데, 다른 설정 변경 없이 `다음` 클릭하며 설치해주세요.
install.rtools()
Sys.setenv(TAR = "C:/Rtools/bin/tar.exe")
```
---

class: inverse

## KoNLP 패키지 설치 및 테스트

KoNLP는 가장 유명한 형태소 분석기입니다.

```{}
install_github("talgalili/installr")
library(installr)

install.java()
install.packages("KoNLP", type = "binary")
library(KoNLP)

test <- "한글 테스트 입니다."
extractNoun(test)
```
맨 마지막 코드로 아래 결과가 나와야 합니다.
```{}
[1] "한글"   "테스트"
```

---
class: inverse

## KoSpacing 패키지 설치 및 테스트

KoSpacing 패키지는 자동 띄어쓰기 기능을 제공합니다.

```{}
library(remotes)
library(installr)

# 설치 화면이 나오는데, 다른 설정 변경 없이 `다음` 클릭하며 설치해주세요.
install.conda()
install_github('haven-jeon/KoSpacing')
library(KoSpacing)
spacing("김형호영화시장분석가는'1987'의네이버영화정보네티즌10점평에서언급된단어들을지난해12월27일부터올해1월10일까지통계프로그램R과KoNLP패키지로텍스트마이닝하여분석했다.")
```

아래 결과가 나오면 성공입니다.
```{}
[1] "김형호 영화시장 분석가는 '1987'의 네이버 영화 정보 네티즌 10점 평에서 언급된 단어들을 지난해 12월 27일부터 올해 1월 10일까지 통계 프로그램 R과 KoNLP 패키지로 텍스트마이닝하여 분석했다."
```

---

class: inverse

## RcppMecab 패키지 설치 및 테스트

RcppMecab은 빠른 형태소 분석기입니다.

```{}
library(remotes)
install_github("mrchypark/RcppMecab")
library(RcppMeCab)
installMecabKoForWindows()
installMecabKoDicForWindows()

test <- "한글 테스트 입니다."
pos(test)
```

아래 결과가 나와야 합니다.

```{}
$`한글 테스트 입니다.`
[1] "한글/NNG"      "테스트/NNG"    "입니다/VCP+EF" "./SF"
```

글자가 깨진다면 아래 코드로 시도해 보세요.

```{}
test <- "한글 테스트 입니다."
test <- iconv(test, to = "UTF-8")
pos(test)
```

---
class: inverse

## 추가 패키지 설치

tidytext 패키지는 텍스트를 tidy하게 다룰 수 있게 해줍니다.    
presidentSpeechKr 패키지는 역대 대통령 연설문 텍스트를 사용할 수 있게 해주는 패키지입니다.

```{}
install.packages("tidytext")
install_github("forkonlp/presidentSpeechKr")

library(tidytext)
library(presidentSpeechKr)
```

위 패키지들는 패키지를 불러오는 것이 동작하는 것을 확인해주세요.

---
class: center, middle, title-slide, inverse

## macOS 사용자

---
class: inverse

## 터미널에서 설치해야 하는 도구들

### 1. JDK8

동영상 가이드를 참고하여 설치해주세요.

<https://www.youtube.com/watch?v=v8xZWbIASc0>

```{}
java -version
```

버전이 1.8.XXXXX 로 표시되면 잘 설치된 것입니다.

---
class: inverse

## 터미널에서 설치해야 하는 도구들

### 2. conda3

맥의 터미널에서 아래 명령어를 수행합니다.   
설치가 시작되면, 모두 yes로 입력하면서 진행하면 설치가 완료됩니다.

```{}
wget https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh
bash Miniconda3-latest-MacOSX-x86_64.sh
```

---
class: inverse

## 터미널에서 설치해야 하는 도구들

### 3. mecab-ko

형태소 분석기를 설치합니다.    
공식 문서를 참고하세요.    
<https://bitbucket.org/eunjeon/mecab-ko-dic>

맥의 터미널에서 아래 명령어를 수행합니다.

```{}
wget https://bitbucket.org/eunjeon/mecab-ko/downloads/mecab-0.996-ko-0.9.2.tar.gz
tar zxfv mecab-0.996-ko-0.9.2.tar.gz
cd mecab-0.996-ko-0.9.2
./configure
make
make check
# 아래 실행 후 컴퓨터 비밀번호 입력
sudo make install
```
---
class: inverse

## 터미널에서 설치해야 하는 도구들

### 4. mecab-ko-dic

형태소 분석기의 사전을 설치합니다.    
공식 문서를 참고하세요.    
<https://bitbucket.org/eunjeon/mecab-ko-dic>

맥의 터미널에서 아래 명령어를 수행합니다.

```{}
wget https://bitbucket.org/eunjeon/mecab-ko-dic/downloads/mecab-ko-dic-2.1.1-20180720.tar.gz
tar zxfv mecab-ko-dic-2.1.1-20180720.tar.gz
cd mecab-ko-dic-2.1.1-20180720
./configure
make
make check
# 아래 실행 후 컴퓨터 비밀번호 입력
sudo make install
```

---
class: inverse

## KoNLP 패키지 설치 및 테스트

KoNLP는 가장 유명한 형태소 분석기입니다.

```{}
install.packages("KoNLP")
library(KoNLP)

test <- "한글 테스트 입니다."
extractNoun(test)
```

아래 결과가 나오면 잘 동작하는 것입니다.
```{}
[1] "한글"   "테스트"
```

---
class: inverse

## KoSpacing 패키지 설치 및 테스트

KoSpacing 패키지는 자동 띄어쓰기 기능을 제공합니다.

```{}
library(devtools)
install_github('haven-jeon/KoSpacing')
library(KoSpacing)
spacing("김형호영화시장분석가는'1987'의네이버영화정보네티즌10점평에서언급된단어들을지난해12월27일부터올해1월10일까지통계프로그램R과KoNLP패키지로텍스트마이닝하여분석했다.")
```

아래 결과가 나오면 성공입니다.
```{}
[1] "김형호 영화시장 분석가는 '1987'의 네이버 영화 정보 네티즌 10점 평에서 언급된 단어들을 지난해 12월 27일부터 올해 1월 10일까지 통계 프로그램 R과 KoNLP 패키지로 텍스트마이닝하여 분석했다."
```

---
class: inverse

## RcppMecab 패키지 설치 및 테스트

RcppMecab은 빠른 형태소 분석기입니다.

```{}
library(devtools)
install_github("junhewk/RcppMeCab")
library(RcppMeCab)

test <- "한글 테스트 입니다."
pos(test)
```

아래 결과가 나와야 합니다.

```{}
$`한글 테스트 입니다.`
[1] "한글/NNG"      "테스트/NNG"    "입니다/VCP+EF" "./SF"
```

---
class: inverse

## 추가 패키지 설치

tidytext 패키지는 텍스트를 tidy하게 다룰 수 있게 해줍니다.    
presidentSpeechKr 패키지는 역대 대통령 연설문 텍스트를 사용할 수 있게 해주는 패키지입니다.

```{}
install.packages("tidytext")
install_github("forkonlp/presidentSpeechKr")

library(tidytext)
library(presidentSpeechKr)
```

위 패키지들는 패키지를 불러오는 것이 동작하는 것을 확인해주세요.

---
class: inverse

### 과제

1. 앞의 가이드에 따라 총 5개 패키지를 설치해 주세요.
1. 아래 코드를 R 콘솔에서 실행하여 스크린샷을 제출해 주세요.

```{}
library(KoNLP)
library(tidytext)
library(presidentSpeechKr)
library(KoSpacing)
library(RcppMeCab)

test <- "한글테스트입니다."
extractNoun(test)
spacing(test)
pos(test)

test <- spacing(test)
extractNoun(test)
```

---

class: center, middle, title-slide, inverse

## tidy data, long form과 wide form

---

class: center, middle, title-slide, inverse

# tidy data + universe 

[![](https://github.com/tidyverse/tidyverse/raw/master/man/figures/logo.png)][1]

---
class: inverse
## [tidyverse][1] 패키지는

.pull-left[
1. RStudio가 개발, 관리하는 패키지    
1. 공식 문서가 매우 잘 되어 있음    
1. 사용자층이 두터워 영어로 검색하면 많은 질답을 찾을 수 있음    
1. 커뮤니티 설명글도 매우 많음    
1. 6개의 핵심 패키지 포함 23가지 패키지로 이루어진 메타 패키지    
1. tidy data 라는 사상과 파이프 연산자로 대동단결    
1. 사상에 영감을 받아 맞춰서 제작하는 개인 패키지가 많음(ex> [tidyquant](https://github.com/business-science/tidyquant), [tidytext](https://github.com/juliasilge/tidytext) 등)
]
.pull-right[
```{r}
if (!requireNamespace("tidyverse")){
  install.packages("tidyverse")}
library(tidyverse)
```
]
---
class: inverse
## tidy data 란

1. [Hadley Wickham](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html)  2. [고감자님의 블로그](http://freesearch.pe.kr/archives/3942)  3. [헬로우데이터과학](http://www.hellodatascience.com/?p=287)


1.1 Each variable forms a column.    
1.2 각 변수는 개별의 열(column)으로 존재한다.    
1.3 각 열에는 개별 속성이 들어간다.    

2.1 Each observation forms a row.    
2.2 각 관측치는 행(row)를 구성한다.    
2.3 각 행에는 개별 관찰 항목이 들어간다.    

3.1 Each type of observational unit forms a table.    
3.2 각 테이블은 단 하나의 관측기준에 의해서 조직된 데이터를 저장한다.    
3.3 각 테이블에는 단일 유형의 데이터가 들어간다.    

.footnote[
  \* 출처 : [금융데이터 분석을 위한 R 입문][2]
]
---
class: inverse
## tidy data 란

![](http://garrettgman.github.io/images/tidy-1.png)

.footnote[
  \* 출처 : [Garrett Grolemund의 Data Science with R 블로그](http://garrettgman.github.io/tidying/)
]

---
class: inverse
## long form vs wide form

.pull-left[
### long form

1. 컴퓨터가 계산하기 좋은 모양
1. tidy data의 요건을 충족
1. tidyverse의 패키지 대부분의 입력 형태
]
.pull-right[
### wide form

1. 사람이 눈으로 보기 좋은 모양
1. 2개 변수에 대한 값만 확인 가능
1. dashboard 형이라고도 하며 조인 등 연산이 어려움
]

---

class: center, middle, title-slide, inverse

## 함수를 연결하는 파이프 연산자(%>%)

![](https://raw.githubusercontent.com/mrchypark/dabrp_classnote3/master/docs/img/pipes.png)

---
class: inverse
## 파이프 연산자(%>%)

함수를 중첩해서 사용할 일이 점점 빈번해 짐

```{}
plot(diff(log(sample(rnorm(10000,mean=10,sd=1),size=100,replace=FALSE))),col="red",type="l")
```

--
class: inverse
### %>%를 사용하면 

.pull-left[

1. 생각의 순서대로 함수를 작성할 수 있음
1. 중간 변수 저장을 할 필요가 없음
1. 순서가 읽이 용이하여 기억하기 좋음
]
.pull-right[
```{}
rnorm(10000,mean=10,sd=1) %>%
  sample(size=100,replace=FALSE) %>%
  log %>%
  diff %>%
  plot(col="red",type="l")
```
]
---
class: inverse

## 파이프 연산자(%>%)

flights 데이터에 파이프 연산자 사용예 1

```{r}
flights %>%
  group_by(year,month,day) %>%
  summarise(delay=mean(dep_delay, na.rm = TRUE))
```
---
class: inverse
## 파이프 연산자(%>%)

group_by()는 filter()와도 함께 사용할 수 있음

```{r}
popular_dests <- flights %>% 
  group_by(dest) %>% 
  filter(n() > 365)
popular_dests

```

---
class: inverse
## 파이프 연산자(%>%)

사용할 데이터부터 순서대로 함수를 작성할 수 있는 장점

```{r}
popular_dests %>% 
  filter(arr_delay > 0) %>% 
  mutate(prop_delay = arr_delay / sum(arr_delay)) %>% 
  select(year:day, dest, arr_delay, prop_delay)
```